"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Mail_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Addons/Mail"));
const Hash_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Hash"));
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
const Env_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Env"));
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
class UsersController {
    async index({ response }) {
        const users = await User_1.default.query().preload('dispositivo', (habitUser) => {
            habitUser.preload('sensores');
        });
        return response.status(200).send({
            type: 'Success!!',
            title: 'Acceso a lista de usuarios',
            message: 'Lista de usuarios',
            data: users
        });
    }
    async show({ response, params }) {
        const users = await User_1.default.query().where('id', params.id).preload('dispositivo', (dispositivo) => {
            dispositivo.preload('sensores', (sensor) => {
                sensor.preload('sensorType');
            }).preload('tipoDispositivo');
        }).preload('configurations').first();
        if (!users) {
            return response.status(404).send({
                type: 'Error',
                title: 'Error al obtener usuario por identificador',
                message: 'No se encontro usuario con este identificador'
            });
        }
        try {
            return response.status(200).send({
                type: 'Success!!',
                title: 'Mostrar usuario y dispositivo',
                message: 'Usuario',
                data: users
            });
        }
        catch (error) {
            if (error.code === 'E_ROW_NOT_FOUND') {
                return response.status(404).send({
                    type: 'Error',
                    title: 'Error al obtener usuario por identificador',
                    message: 'No se encontro usuario con este identificador',
                    error: error
                });
            }
        }
    }
    async SendCodigo({ response, params }) {
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        const user = await User_1.default.findOrFail(params.id);
        const codigo = this.generateVerificationCode();
        const email = user.email;
        await Mail_1.default.send((message) => {
            message
                .from(Env_1.default.get('SMTP_USERNAME'), 'Healthy App')
                .to(email)
                .subject('Healthy App - Codigo de verifiacion')
                .htmlView('emails/VerificationCode', { codigo });
        });
        user.verificationCode = codigo;
        await user.save();
        return response.status(200).send({
            type: 'Success!!',
            title: 'Codigo de verificacion enviado a tu correo electronico',
        });
    }
    async register({ request, response }) {
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        try {
            const name = request.input('name');
            const lastname = request.input('lastname');
            const email = request.input('email');
            const password = request.input('password');
            const existingUser = await User_1.default.findBy('email', email);
            if (existingUser) {
                return response.status(400).json({
                    type: 'Error',
                    message: 'Error al crear usuario',
                    error: 'Correo electr칩nico ya registrado',
                });
            }
            if (password.length < 8) {
                return response.status(400).json({
                    type: 'Error',
                    message: 'Error al crear usuario',
                    error: 'La contrase침a debe tener al menos 8 caracteres',
                });
            }
            const newUser = new User_1.default();
            newUser.name = name;
            newUser.lastname = lastname;
            newUser.email = email;
            newUser.password = await Hash_1.default.make(password);
            const verificationCode = this.generateVerificationCode();
            newUser.verificationCode = verificationCode;
            await newUser.save();
            const emailData = { code: verificationCode };
            await Mail_1.default.send((message) => {
                message
                    .from(Env_1.default.get('SMTP_USERNAME'), 'Healthy App')
                    .to(email)
                    .subject('Healthy App - Verificaci칩n de cuenta')
                    .htmlView('emails/welcome', emailData);
            });
            const accountSid = Env_1.default.get('TWILIO_ACCOUNT_SID');
            const authToken = Env_1.default.get('TWILIO_AUTH_TOKEN');
            const client = require('twilio')(accountSid, authToken);
            await client.messages.create({
                body: "Gracias por registrarte en HealthyApp :D",
                from: Env_1.default.get('TWILIO_FROM_NUMBER'),
                to: `+528714446301`
            });
            return response.status(201).json({
                type: 'Success!!',
                title: 'Registro correctamente',
                message: 'Usuario registrado correctamente',
                data: {
                    user_id: newUser.id,
                    name: newUser.name,
                    lastname: newUser.lastname,
                    email: newUser.email,
                    message: 'Se ha enviado un codigo de verificacion a tu correo electromico'
                },
            });
        }
        catch (error) {
            return response.status(400).json({
                type: 'Error',
                title: 'Error registrar usuario',
                message: 'Error al crear usuario',
                error: error.message,
            });
        }
    }
    generateVerificationCode() {
        const randomNumber = Math.floor(1000 + Math.random() * 9000);
        return randomNumber.toString();
    }
    async update({ auth, request, response }) {
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        try {
            const user = await User_1.default.query().where('id', auth.user?.id).preload('dispositivo', (dispositivo) => {
                dispositivo.preload('sensores', (sensor) => {
                    sensor.preload('sensorType');
                }).preload('tipoDispositivo');
            }).preload('configurations').first();
            if (!user) {
                return response.status(404).json({
                    type: 'Error',
                    title: 'Usuario no encontrado',
                    message: 'Error al encontrar los datos del usuario',
                    error: []
                });
            }
            const { name, lastname, email } = request.only(['name', 'lastname', 'email']);
            const updates = {};
            if (name !== undefined) {
                updates.name = name;
            }
            if (lastname !== undefined) {
                updates.lastname = lastname;
            }
            if (email !== undefined) {
                updates.email = email;
            }
            await Database_1.default.from('users').where('id', user.id).update(updates);
            const updatedUser = await Database_1.default.from('users').where('id', user.id).first();
            await Mail_1.default.send((message) => {
                message
                    .from(Env_1.default.get('SMTP_USERNAME'), 'Healthy App')
                    .to(user.email)
                    .subject('Healthy App - Personalizacion de cuenta')
                    .htmlView('emails/actualizarUser', { name: updates.name || user.name, lastname: updates.lastname || user.lastname, email: updates.email || user.email });
            });
            return response.status(200).json({
                type: 'Success!!',
                title: 'Datos actualizados',
                message: 'Datos de usuario actualizados',
                data: updatedUser
            });
        }
        catch (error) {
            return response.status(500).json({
                type: 'Error',
                title: 'Error de servidor',
                message: 'Error interno del servidor al actualizar los datos del usuario',
                error: error.message
            });
        }
    }
    async updatePassword({ auth, request, response }) {
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        try {
            const userId = auth.user?.id;
            if (!userId) {
                return response.status(401).json({ error: 'Usuario no autenticado' });
            }
            const user = await User_1.default.query()
                .where('id', userId)
                .preload('dispositivo', (dispositivo) => {
                dispositivo.preload('sensores', (sensor) => {
                    sensor.preload('sensorType');
                }).preload('tipoDispositivo');
            }).preload('configurations').first();
            if (!user) {
                return response.status(404).json({
                    type: 'Error',
                    title: 'Usuario no encontrado',
                    message: 'Error al encontrar los datos del usuario',
                    error: []
                });
            }
            const oldPassword = request.input('oldPassword');
            const newPassword = request.input('newPassword');
            const isPasswordValid = await Hash_1.default.verify(user.password, oldPassword);
            if (!isPasswordValid) {
                return response.status(401).json({ error: 'La contrase침a anterior es incorrecta' });
            }
            if (newPassword.length < 8) {
                return response.status(400).json({ error: 'La nueva contrase침a debe tener al menos 8 caracteres' });
            }
            user.password = await Hash_1.default.make(newPassword);
            await user.save();
            await Mail_1.default.send((message) => {
                message
                    .from(Env_1.default.get('SMTP_USERNAME'), 'Healthy App')
                    .to(user.email)
                    .subject('Healthy App - Recuperacion de Contrase침a')
                    .htmlView('emails/nuevaContrasena', { email: user.email });
            });
            return response.status(200).json({
                type: 'Exitoso!!',
                title: 'Contrase침a actualizada',
                message: 'Contrase침a de usuario actualizada',
                data: user
            });
        }
        catch (error) {
            return response.status(500).json({
                type: 'Error',
                title: 'Error al actualizar contrase침a',
                message: 'Error interno del servidor al actualizar la contrase침a del usuario',
                error: error.message
            });
        }
    }
    async destroy({ response, auth }) {
        try {
            const usuario = auth.user;
            await usuario.delete();
            return response.status(204).send({
                type: 'Exitoso!!',
                title: 'Exito al eliminar usuario',
                message: 'Usuario eliminado exitosamente',
                data: usuario
            });
        }
        catch (error) {
            return response.status(400).send({
                type: 'Error',
                title: 'Error al aliminar usuario',
                message: 'Se produjo un error al eliminar usuario'
            });
        }
    }
    async authLogin({ request, response }) {
        try {
            const user_email = request.input('user_email');
            const password = request.input('password');
            const verificationCode = request.input('verification_code');
            const user = await User_1.default.query()
                .where('email', user_email)
                .where('verification_code', verificationCode)
                .whereNull('deleted_at')
                .first();
            if (!user || user.verificationCode !== verificationCode) {
                return response.status(401).send({
                    type: 'warning',
                    title: 'Datos inv치lidos',
                    message: 'Usuario no verificado o datos incorrectos',
                });
            }
            if (!(await Hash_1.default.verify(user.password, password))) {
                return response.status(401).send({
                    type: 'warning',
                    title: 'Datos inv치lidos',
                    message: 'Contrase침a incorrecta',
                });
            }
            user.verificationCode = null;
            await user.save();
            return response.status(200).json({
                type: 'Exitoso!!',
                title: 'Verificado',
                message: 'Cuenta Verificada Correctamente'
            });
        }
        catch (error) {
            return response.status(400).json({
                type: 'Error',
                title: 'Error de inicio',
                message: 'Error al iniciar sesi칩n',
                error: error.message,
            });
        }
    }
    async logout({ auth, response }) {
        try {
            await auth.logout();
            return response.status(200).send({
                type: 'Exitoso!!',
                title: 'Logout exitoso',
                message: 'Logout exitosamente '
            });
        }
        catch (error) {
            return response.status(200).send({
                type: 'Error',
                title: 'Error al cerrar sesion',
                message: 'Se produjo un error al cerrar sesion'
            });
        }
    }
    async login({ request, auth, response }) {
        try {
            const email = request.input('email');
            const password = request.input('password');
            const user = await User_1.default.query().where('email', email).preload('dispositivo', (dispositivo) => {
                dispositivo.preload('sensores', (sensor) => {
                    sensor.preload('sensorType');
                }).preload('tipoDispositivo');
            }).preload('configurations').first();
            if (!user) {
                return response.status(401).json({ message: 'Usuario no encontrado' });
            }
            const isPasswordValid = await Hash_1.default.verify(user.password, password);
            if (!isPasswordValid) {
                return response.status(401).json({ message: 'Contrase침a incorrecta' });
            }
            if (user.verificationCode !== null) {
                return response.status(401).json({ message: 'El usuario a칰n no est치 verificado. Por favor, verifique su cuenta.' });
            }
            const token = await auth.use('api').generate(user, { expiresIn: '3 days' });
            return response.status(200).json({
                type: 'Exitoso!!',
                title: 'Login exitoso',
                message: 'Login exitosamente',
                data: {
                    token,
                    user,
                },
            });
        }
        catch (error) {
            return response.status(500).json({
                type: 'Error',
                title: 'Error al iniciar sesion',
                message: 'Error al iniciar sesi칩n', error: error.message
            });
        }
    }
    async correorecuperacion({ request, response }) {
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        try {
            const email = request.input('email');
            const user = await User_1.default.query().where('email', email).preload('dispositivo', (dispositivo) => {
                dispositivo.preload('sensores', (sensor) => {
                    sensor.preload('sensorType');
                }).preload('tipoDispositivo');
            }).preload('configurations').first();
            if (!user) {
                return response.status(400).json({
                    message: 'No se encontr칩 un usuario con este correo electr칩nico.',
                });
            }
            const verificationCode = this.generarcodigo();
            user.verificationCode = verificationCode;
            await user.save();
            await Mail_1.default.send((message) => {
                message
                    .from(Env_1.default.get('SMTP_USERNAME'), 'Healthy App')
                    .to(email)
                    .subject('Recuperaci칩n de Contrase침a')
                    .htmlView('emails/recuperacion', { verificationCode });
            });
            return response.status(200).json({
                message: 'Se ha enviado un correo electr칩nico con un c칩digo de recuperaci칩n.',
            });
        }
        catch (error) {
            return response.status(500).json({
                message: 'Error al enviar el correo electr칩nico de recuperaci칩n.',
                error: error.message,
            });
        }
    }
    generarcodigo() {
        const randomNumber = Math.floor(1000 + Math.random() * 9000);
        return randomNumber.toString();
    }
}
exports.default = UsersController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlcnNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXNlcnNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsb0ZBQTBDO0FBQzFDLGtGQUF3QztBQUV4QyxpRkFBa0M7QUFDbEMsZ0ZBQXNDO0FBQ3RDLDJGQUFrRDtBQUdsRCxNQUFxQixlQUFlO0lBeUIzQixLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsUUFBUSxFQUF1QjtRQUVsRCxNQUFNLEtBQUssR0FBRyxNQUFNLGNBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFDLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDbkUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUMvQixDQUFDLENBQUMsQ0FBQTtRQUNGLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDL0IsSUFBSSxFQUFFLFdBQVc7WUFDakIsS0FBSyxFQUFFLDRCQUE0QjtZQUNuQyxPQUFPLEVBQUUsbUJBQW1CO1lBQzVCLElBQUksRUFBRSxLQUFLO1NBQ1osQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQW1DUSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsUUFBUSxFQUFDLE1BQU0sRUFBdUI7UUFDeEQsTUFBTSxLQUFLLEdBQUcsTUFBTSxjQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksRUFBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQzNGLFdBQVcsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFDLENBQUMsTUFBTSxFQUFDLEVBQUU7Z0JBQ3ZDLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUE7WUFDOUIsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFD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QUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQy9CLE9BQU8sRUFBRSxvRUFBb0U7YUFDOUUsQ0FBQyxDQUFBO1NBQ0g7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQy9CLE9BQU8sRUFBRSx3REFBd0Q7Z0JBQ2pFLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTzthQUNyQixDQUFDLENBQUE7U0FDSDtJQUNILENBQUM7SUFDTSxhQUFhO1FBQ2xCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUM1RCxPQUFPLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0NBQ0Y7QUFyN0JELGtDQXE3QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWFpbCBmcm9tICdAaW9jOkFkb25pcy9BZGRvbnMvTWFpbCdcclxuaW1wb3J0IEhhc2ggZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IYXNoJ1xyXG5pbXBvcnQgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcclxuaW1wb3J0IFVzZXIgZnJvbSAnQXBwL01vZGVscy9Vc2VyJ1xyXG5pbXBvcnQgRW52IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvRW52J1xyXG5pbXBvcnQgRGF0YWJhc2UgZnJvbSAnQGlvYzpBZG9uaXMvTHVjaWQvRGF0YWJhc2UnO1xyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJzQ29udHJvbGxlciB7XHJcbiAgLyoqXHJcbiAgICogQHN3YWdnZXJcclxuICAgKiAvYXBpL3VzZXJzOlxyXG4gICAqICBnZXQ6XHJcbiAgICogICAgdGFnczpcclxuICAgKiAgICAgIC0gdXNlcnNcclxuICAgKiAgICBzdW1tYXJ5OiBMaXN0YSBkZSB1c3Vhcmlvc1xyXG4gICAqICAgIHByb2R1Y2VzOlxyXG4gICAqICAgICAgLSBhcHBsaWNhdGlvbi9qc29uXHJcbiAgICogICAgcmVzcG9uc2VzOlxyXG4gICAqICAgICAgMjAwOlxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogU3VjY2VzcyEhXHJcbiAgICogICAgICAgIGNvbnRlbnQ6XHJcbiAgICogICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgIHNjaGVtYTpcclxuICAgKiAgICAgICAgICAgICAgdHlwZTogb2JqZWN0XHJcbiAgICogICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgICAgdGl0bGU6XHJcbiAgICogICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aXRsZSBcclxuICAgKiAgICAgICAgICAgICAgICBkYXRhOlxyXG4gICAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nIFxyXG4gICAqICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGphamFqYWpcclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgaW5kZXgoeyByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgXHJcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IFVzZXIucXVlcnkoKS5wcmVsb2FkKCdkaXNwb3NpdGl2bycsKGhhYml0VXNlcikgPT4ge1xyXG4gICAgICBoYWJpdFVzZXIucHJlbG9hZCgnc2Vuc29yZXMnKVxyXG4gICAgfSlcclxuICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgdHlwZTogJ1N1Y2Nlc3MhIScsXHJcbiAgICAgIHRpdGxlOiAnQWNjZXNvIGEgbGlzdGEgZGUgdXN1YXJpb3MnLFxyXG4gICAgICBtZXNzYWdlOiAnTGlzdGEgZGUgdXN1YXJpb3MnLFxyXG4gICAgICBkYXRhOiB1c2Vyc1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICogQHN3YWdnZXJcclxuICAgKiAvYXBpL3VzZXJzL3tpZH06XHJcbiAgICogIGdldDpcclxuICAgKiAgICBzZWN1cml0eTpcclxuICAgKiAgICAgIC0gYmVhcmVyQXV0aDogW11cclxuICAgKiAgICB0YWdzOlxyXG4gICAqICAgICAgLSB1c2Vyc1xyXG4gICAqICAgIHN1bW1hcnk6IExpc3RhIGRlIHVzdWFyaW9zXHJcbiAgICogICAgcHJvZHVjZXM6XHJcbiAgICogICAgICAtIGFwcGxpY2F0aW9uL2pzb25cclxuICAgKiAgICBwYXJhbWV0ZXJzOlxyXG4gICAqICAgICAgLSBuYW1lOiBpZFxyXG4gICAqICAgICAgICBpbjogcGF0aFxyXG4gICAqICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogSUQgZGVsIHVzdWFyaW8gYSBtb3N0cmFyLlxyXG4gICAqICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgdHlwZTogaW50ZWdlclxyXG4gICAqICAgIHJlc3BvbnNlczpcclxuICAgKiAgICAgIDIwMDpcclxuICAgKiAgICAgICAgZGVzY3JpcHRpb246IFN1Y2Nlc3MhIVxyXG4gICAqICAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICogICAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gICAqICAgICAgICAgICAgICAgIHRpdGxlOlxyXG4gICAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGl0bGUgXHJcbiAgICogICAgICAgICAgICAgICAgZGF0YTpcclxuICAgKiAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZyBcclxuICAgKiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBqYWphamFqXHJcbiAgICovXHJcbiAgICBwdWJsaWMgYXN5bmMgc2hvdyh7IHJlc3BvbnNlLHBhcmFtcyB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgVXNlci5xdWVyeSgpLndoZXJlKCdpZCcscGFyYW1zLmlkKS5wcmVsb2FkKCdkaXNwb3NpdGl2bycsKGRpc3Bvc2l0aXZvKSA9PiB7XHJcbiAgICAgICAgZGlzcG9zaXRpdm8ucHJlbG9hZCgnc2Vuc29yZXMnLChzZW5zb3IpPT57XHJcbiAgICAgICAgICBzZW5zb3IucHJlbG9hZCgnc2Vuc29yVHlwZScpXHJcbiAgICAgICAgfSkucHJlbG9hZCgndGlwb0Rpc3Bvc2l0aXZvJylcclxuICAgICAgfSkucHJlbG9hZCgnY29uZmlndXJhdGlvbnMnKS5maXJzdCgpXHJcbiAgICAgIGlmKCF1c2Vycyl7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoe1xyXG4gICAgICAgICAgdHlwZTogJ0Vycm9yJyxcclxuICAgICAgICAgIHRpdGxlOiAnRXJyb3IgYWwgb2J0ZW5lciB1c3VhcmlvIHBvciBpZGVudGlmaWNhZG9yJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdObyBzZSBlbmNvbnRybyB1c3VhcmlvIGNvbiBlc3RlIGlkZW50aWZpY2Fkb3InXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgICB0cnl7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICB0eXBlOiAnU3VjY2VzcyEhJyxcclxuICAgICAgICB0aXRsZTogJ01vc3RyYXIgdXN1YXJpbyB5IGRpc3Bvc2l0aXZvJyxcclxuICAgICAgICBtZXNzYWdlOiAnVXN1YXJpbycsXHJcbiAgICAgICAgZGF0YTogdXNlcnNcclxuICAgICAgfSlcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnRV9ST1dfTk9UX0ZPVU5EJykge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDA0KS5zZW5kKHtcclxuICAgICAgICAgIHR5cGU6ICdFcnJvcicsXHJcbiAgICAgICAgICB0aXRsZTogJ0Vycm9yIGFsIG9idGVuZXIgdXN1YXJpbyBwb3IgaWRlbnRpZmljYWRvcicsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnTm8gc2UgZW5jb250cm8gdXN1YXJpbyBjb24gZXN0ZSBpZGVudGlmaWNhZG9yJyxcclxuICAgICAgICAgIGVycm9yOmVycm9yXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBzd2FnZ2VyXHJcbiAgICogL2FwaS91c2Vycy9jb2RlLXZlcmlmeS97aWR9OlxyXG4gICAqICBwb3N0OlxyXG4gICAqICAgIHNlY3VyaXR5OlxyXG4gICAqICAgICAgLSBiZWFyZXJBdXRoOiBbXVxyXG4gICAqICAgIHRhZ3M6XHJcbiAgICogICAgICAtIHVzZXJzXHJcbiAgICogICAgc3VtbWFyeTogQ29kaWdvIGRlIHZlcmlmaWNhY2lvblxyXG4gICAqICAgIGRlc2NyaXB0aW9uOiBNYW5kYXIgY29kaWdvIGRlIHZlcmlmaWNhY2lvbiBcclxuICAgKiAgICBwYXJhbWV0ZXJzOlxyXG4gICAqICAgICAgLSBuYW1lOiBpZFxyXG4gICAqICAgICAgICBpbjogcGF0aFxyXG4gICAqICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogSWRcclxuICAgKiAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgIHJlcXVlc3RCb2R5OlxyXG4gICAqICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgKiAgICAgIGNvbnRlbnQ6XHJcbiAgICogICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICogICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgdHlwZTogb2JqZWN0XHJcbiAgICogICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gICAqICAgICAgICAgICAgICBlbWFpbDpcclxuICAgKiAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICByZXNwb25zZXM6XHJcbiAgICogICAgICAgMjAwOlxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogRGF0b3MgZGUgdXN1YXJpbyBhY3R1YWxpemFkb3MgZXhpdG9zYW1lbnRlLlxyXG4gICAqICAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICogICAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gICAqICAgICAgICAgICAgICAgIG1lc3NhZ2U6XHJcbiAgICogICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNZW5zYWplIGluZGljYW5kbyBlbCDDqXhpdG8gZGUgbGEgYWN0dWFsaXphY2nDs24uXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIFNlbmRDb2RpZ28oe3Jlc3BvbnNlLCBwYXJhbXN9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9UTFNfUkVKRUNUX1VOQVVUSE9SSVpFRCA9ICcwJztcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPckZhaWwocGFyYW1zLmlkKTtcclxuICAgIGNvbnN0IGNvZGlnbyA9IHRoaXMuZ2VuZXJhdGVWZXJpZmljYXRpb25Db2RlKClcclxuICAgIGNvbnN0IGVtYWlsID0gdXNlci5lbWFpbFxyXG5cclxuICAgIGF3YWl0IE1haWwuc2VuZCgobWVzc2FnZSkgPT4ge1xyXG4gICAgICBtZXNzYWdlXHJcbiAgICAgICAgLmZyb20oRW52LmdldCgnU01UUF9VU0VSTkFNRScpLCAnSGVhbHRoeSBBcHAnKVxyXG4gICAgICAgIC50byhlbWFpbClcclxuICAgICAgICAuc3ViamVjdCgnSGVhbHRoeSBBcHAgLSBDb2RpZ28gZGUgdmVyaWZpYWNpb24nKVxyXG4gICAgICAgIC5odG1sVmlldygnZW1haWxzL1ZlcmlmaWNhdGlvbkNvZGUnLHtjb2RpZ299KTtcclxuICAgIH0pO1xyXG4gICAgdXNlci52ZXJpZmljYXRpb25Db2RlID0gY29kaWdvXHJcbiAgICBhd2FpdCB1c2VyLnNhdmUoKVxyXG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLnNlbmQoe1xyXG4gICAgICB0eXBlOiAnU3VjY2VzcyEhJyxcclxuICAgICAgdGl0bGU6J0NvZGlnbyBkZSB2ZXJpZmljYWNpb24gZW52aWFkbyBhIHR1IGNvcnJlbyBlbGVjdHJvbmljbycsXHJcbiAgICB9KVxyXG4gIH1cclxuICAvKipcclxuICAgKiBAc3dhZ2dlclxyXG4gICAqIC9hcGkvdXNlcnM6XHJcbiAgICogIHBvc3Q6XHJcbiAgICogICAgICB0YWdzOlxyXG4gICAqICAgICAgICAtIHVzZXJzXHJcbiAgICogICAgICBzdW1tYXJ5OiBDcmVhciB1biBudWV2byB1c3VhcmlvXHJcbiAgICogICAgICBkZXNjcmlwdGlvbjogQ3JlYSB1biBudWV2byB1c3VhcmlvIGNvbiBsb3MgZGF0b3MgcHJvcG9yY2lvbmFkb3MgeSBlbnbDrWEgdW4gY29ycmVvIGVsZWN0csOzbmljbyBkZSB2ZXJpZmljYWNpw7NuLlxyXG4gICAqICAgICAgcmVxdWVzdEJvZHk6XHJcbiAgICogICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICogICAgICAgIGNvbnRlbnQ6XHJcbiAgICogICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgIHNjaGVtYTpcclxuICAgKiAgICAgICAgICAgICAgJHJlZjogJyMvY29tcG9uZW50cy9zY2hlbWFzL1VzZXJJbnB1dCdcclxuICAgKiAgICAgICAgICAgIGV4YW1wbGU6XHJcbiAgICogICAgICAgICAgICAgIG5hbWU6IEpvaG5cclxuICAgKiAgICAgICAgICAgICAgbGFzdG5hbWU6IERvZVxyXG4gICAqICAgICAgICAgICAgICBlbWFpbDogam9obi5kb2VAZXhhbXBsZS5jb21cclxuICAgKiAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkMTIzXHJcbiAgICogICAgICByZXNwb25zZXM6XHJcbiAgICogICAgICAgIDIwMTpcclxuICAgKiAgICAgICAgICBkZXNjcmlwdGlvbjogVXN1YXJpbyBjcmVhZG8gZXhpdG9zYW1lbnRlLiBTZSBoYSBlbnZpYWRvIHVuIGNvcnJlbyBlbGVjdHLDs25pY28gZGUgdmVyaWZpY2FjacOzbi5cclxuICAgKiAgICAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgICAgICBkYXRhOlxyXG4gICAqICAgICAgICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOlxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbnVtYmVyXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogSUQgZGVsIHVzdWFyaW8gY3JlYWRvLlxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgIG5hbWU6XHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBOb21icmUgZGVsIHVzdWFyaW8uXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgbGFzdG5hbWU6XHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBBcGVsbGlkbyBkZWwgdXN1YXJpby5cclxuICAgKiAgICAgICAgICAgICAgICAgICAgICBlbWFpbDpcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IENvcnJlbyBlbGVjdHLDs25pY28gZGVsIHVzdWFyaW8uXHJcbiAgICogICAgICAgIDQwMDpcclxuICAgKiAgICAgICAgICBkZXNjcmlwdGlvbjogRXJyb3IgYWwgY3JlYXIgZWwgdXN1YXJpby4gRWwgY29ycmVvIGVsZWN0csOzbmljbyBwcm9wb3JjaW9uYWRvIHlhIGVzdMOhIHJlZ2lzdHJhZG8uXHJcbiAgICogICAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICogICAgICAgICAgICAgIHNjaGVtYTpcclxuICAgKiAgICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gICAqICAgICAgICAgICAgICAgICAgbWVzc2FnZTpcclxuICAgKiAgICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICAgIGV4YW1wbGU6IEVycm9yIGFsIGNyZWFyIHVzdWFyaW9cclxuICAgKiAgICAgICAgICAgICAgICAgIGVycm9yOlxyXG4gICAqICAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgICAgZXhhbXBsZTogQ29ycmVvIGVsZWN0csOzbmljbyB5YSByZWdpc3RyYWRvXHJcbiAgICogICAgICAgIDUwMDpcclxuICAgKiAgICAgICAgICBkZXNjcmlwdGlvbjogRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3IgYWwgaW50ZW50YXIgY3JlYXIgZWwgdXN1YXJpby5cclxuICAgKiAgICAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgICAgICBtZXNzYWdlOlxyXG4gICAqICAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgICAgZXhhbXBsZTogRXJyb3IgYWwgY3JlYXIgdXN1YXJpb1xyXG4gICAqICAgICAgICAgICAgICAgICAgZXJyb3I6XHJcbiAgICogICAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgICAgICAgICAgICAgICAgICBleGFtcGxlOiBEZXNjcmlwY2nDs24gZGVsIGVycm9yIGludGVybm9cclxuICAgKiAgY29tcG9uZW50czpcclxuICAgKiAgICBzY2hlbWFzOlxyXG4gICAqICAgICAgVXNlcklucHV0OlxyXG4gICAqICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICBuYW1lOlxyXG4gICAqICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgbGFzdG5hbWU6XHJcbiAgICogICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICBlbWFpbDpcclxuICAgKiAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgICAgICAgIHBhc3N3b3JkOlxyXG4gICAqICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgIHJlcXVpcmVkOlxyXG4gICAqICAgICAgICAgIC0gbmFtZVxyXG4gICAqICAgICAgICAgIC0gbGFzdG5hbWVcclxuICAgKiAgICAgICAgICAtIGVtYWlsXHJcbiAgICogICAgICAgICAgLSBwYXNzd29yZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyByZWdpc3Rlcih7IHJlcXVlc3QsIHJlc3BvbnNlfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9UTFNfUkVKRUNUX1VOQVVUSE9SSVpFRCA9ICcwJztcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5hbWUgPSByZXF1ZXN0LmlucHV0KCduYW1lJyk7XHJcbiAgICAgIGNvbnN0IGxhc3RuYW1lID0gcmVxdWVzdC5pbnB1dCgnbGFzdG5hbWUnKTtcclxuICAgICAgY29uc3QgZW1haWwgPSByZXF1ZXN0LmlucHV0KCdlbWFpbCcpXHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gcmVxdWVzdC5pbnB1dCgncGFzc3dvcmQnKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhciBzaSBlbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIHlhIGV4aXN0ZVxyXG4gICAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIGlmIChleGlzdGluZ1VzZXIpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICB0eXBlOiAnRXJyb3InLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW8nLFxyXG4gICAgICAgICAgZXJyb3I6ICdDb3JyZW8gZWxlY3Ryw7NuaWNvIHlhIHJlZ2lzdHJhZG8nLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocGFzc3dvcmQubGVuZ3RoIDwgOCkge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgIHR5cGU6ICdFcnJvcicsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgY3JlYXIgdXN1YXJpbycsXHJcbiAgICAgICAgICBlcnJvcjogJ0xhIGNvbnRyYXNlw7FhIGRlYmUgdGVuZXIgYWwgbWVub3MgOCBjYXJhY3RlcmVzJyxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgbmV3VXNlciA9IG5ldyBVc2VyKCk7XHJcbiAgICAgIG5ld1VzZXIubmFtZSA9IG5hbWU7XHJcbiAgICAgIG5ld1VzZXIubGFzdG5hbWUgPSBsYXN0bmFtZTtcclxuICAgICAgbmV3VXNlci5lbWFpbCA9IGVtYWlsO1xyXG4gICAgICBuZXdVc2VyLnBhc3N3b3JkID0gYXdhaXQgSGFzaC5tYWtlKHBhc3N3b3JkKTtcclxuXHJcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkNvZGUgPSB0aGlzLmdlbmVyYXRlVmVyaWZpY2F0aW9uQ29kZSgpO1xyXG4gICAgICBuZXdVc2VyLnZlcmlmaWNhdGlvbkNvZGUgPSB2ZXJpZmljYXRpb25Db2RlO1xyXG5cclxuICAgICAgYXdhaXQgbmV3VXNlci5zYXZlKCk7XHJcblxyXG4gICAgICBjb25zdCBlbWFpbERhdGEgPSB7IGNvZGU6IHZlcmlmaWNhdGlvbkNvZGUgfTtcclxuXHJcbiAgICAgIGF3YWl0IE1haWwuc2VuZCgobWVzc2FnZSkgPT4ge1xyXG4gICAgICAgIG1lc3NhZ2VcclxuICAgICAgICAgIC5mcm9tKEVudi5nZXQoJ1NNVFBfVVNFUk5BTUUnKSwgJ0hlYWx0aHkgQXBwJylcclxuICAgICAgICAgIC50byhlbWFpbClcclxuICAgICAgICAgIC5zdWJqZWN0KCdIZWFsdGh5IEFwcCAtIFZlcmlmaWNhY2nDs24gZGUgY3VlbnRhJylcclxuICAgICAgICAgIC5odG1sVmlldygnZW1haWxzL3dlbGNvbWUnLCBlbWFpbERhdGEpO1xyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGFjY291bnRTaWQgPSBFbnYuZ2V0KCdUV0lMSU9fQUNDT1VOVF9TSUQnKVxyXG4gICAgICBjb25zdCBhdXRoVG9rZW4gPSBFbnYuZ2V0KCdUV0lMSU9fQVVUSF9UT0tFTicpXHJcbiAgICAgIGNvbnN0IGNsaWVudCA9IHJlcXVpcmUoJ3R3aWxpbycpKGFjY291bnRTaWQsIGF1dGhUb2tlbilcclxuXHJcblxyXG4gICBcclxuICAgICAgYXdhaXQgY2xpZW50Lm1lc3NhZ2VzLmNyZWF0ZSh7XHJcbiAgICAgICAgYm9keTogXCJHcmFjaWFzIHBvciByZWdpc3RyYXJ0ZSBlbiBIZWFsdGh5QXBwIDpEXCIsXHJcbiAgICAgICAgZnJvbTogRW52LmdldCgnVFdJTElPX0ZST01fTlVNQkVSJyksXHJcbiAgICAgICAgdG86YCs1Mjg3MTQ0NDYzMDFgXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgdHlwZTogJ1N1Y2Nlc3MhIScsXHJcbiAgICAgICAgdGl0bGU6ICdSZWdpc3RybyBjb3JyZWN0YW1lbnRlJyxcclxuICAgICAgICBtZXNzYWdlOidVc3VhcmlvIHJlZ2lzdHJhZG8gY29ycmVjdGFtZW50ZScsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgdXNlcl9pZDogbmV3VXNlci5pZCxcclxuICAgICAgICAgIG5hbWU6IG5ld1VzZXIubmFtZSxcclxuICAgICAgICAgIGxhc3RuYW1lOiBuZXdVc2VyLmxhc3RuYW1lLFxyXG4gICAgICAgICAgZW1haWw6IG5ld1VzZXIuZW1haWwsXHJcbiAgICAgICAgbWVzc2FnZTogJ1NlIGhhIGVudmlhZG8gdW4gY29kaWdvIGRlIHZlcmlmaWNhY2lvbiBhIHR1IGNvcnJlbyBlbGVjdHJvbWljbydcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICB0eXBlOiAnRXJyb3InLFxyXG4gICAgICAgIHRpdGxlOiAnRXJyb3IgcmVnaXN0cmFyIHVzdWFyaW8nLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBjcmVhciB1c3VhcmlvJyxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2VuZXJhdGVWZXJpZmljYXRpb25Db2RlKCkge1xyXG4gICAgY29uc3QgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcigxMDAwICsgTWF0aC5yYW5kb20oKSAqIDkwMDApO1xyXG4gICAgcmV0dXJuIHJhbmRvbU51bWJlci50b1N0cmluZygpO1xyXG4gIH1cclxuLyoqXHJcbiAqIEBzd2FnZ2VyXHJcbiAqIC9hcGkvdXNlcnMvYWN0dWFsaXphcjpcclxuICogIHB1dDpcclxuICogICAgc2VjdXJpdHk6XHJcbiAqICAgICAgLSBiZWFyZXJBdXRoOiBbXVxyXG4gKiAgICB0YWdzOlxyXG4gKiAgICAgIC0gdXNlcnNcclxuICogICAgc3VtbWFyeTogQWN0dWFsaXphY2nDs24gZGUgZGF0b3MgZGUgdXN1YXJpb1xyXG4gKiAgICBkZXNjcmlwdGlvbjogQWN0dWFsaXphIGxvcyBkYXRvcyBkZSB1biB1c3VhcmlvIGV4aXN0ZW50ZS4gQ2FkYSBjYW1wbyBlcyBvcGNpb25hbCB5IHNlIGFjdHVhbGl6YXLDoSBzb2xvIHNpIGVzdMOhIHByZXNlbnRlIGVuIGxhIHNvbGljaXR1ZC5cclxuICogICAgcmVxdWVzdEJvZHk6XHJcbiAqICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICogICAgICBjb250ZW50OlxyXG4gKiAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICogICAgICAgICAgc2NoZW1hOlxyXG4gKiAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gKiAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAqICAgICAgICAgICAgICBuYW1lOlxyXG4gKiAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICogICAgICAgICAgICAgIGxhc3RuYW1lOlxyXG4gKiAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICogICAgICAgICAgICAgIGVtYWlsOlxyXG4gKiAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICogICAgcmVzcG9uc2VzOlxyXG4gKiAgICAgICAyMDA6XHJcbiAqICAgICAgICBkZXNjcmlwdGlvbjogRGF0b3MgZGUgdXN1YXJpbyBhY3R1YWxpemFkb3MgZXhpdG9zYW1lbnRlLlxyXG4gKiAgICAgICAgY29udGVudDpcclxuICogICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICogICAgICAgICAgICBzY2hlbWE6XHJcbiAqICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICogICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAqICAgICAgICAgICAgICAgIG1lc3NhZ2U6XHJcbiAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAqICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IE1lbnNhamUgaW5kaWNhbmRvIGVsIMOpeGl0byBkZSBsYSBhY3R1YWxpemFjacOzbi5cclxuICogICAgICAgNDAxOlxyXG4gKiAgICAgICAgZGVzY3JpcHRpb246IFVzdWFyaW8gbm8gYXV0ZW50aWNhZG8uXHJcbiAqICAgICAgICBjb250ZW50OlxyXG4gKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gKiAgICAgICAgICAgIHNjaGVtYTpcclxuICogICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gKiAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICogICAgICAgICAgICAgICAgZXJyb3I6XHJcbiAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAqICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IE1lbnNhamUgaW5kaWNhbmRvIGVsIGVycm9yIGRlIGF1dGVudGljYWNpw7NuLlxyXG4gKiAgICAgICA1MDA6XHJcbiAqICAgICAgICBkZXNjcmlwdGlvbjogRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3IgYWwgYWN0dWFsaXphciBsb3MgZGF0b3MgZGVsIHVzdWFyaW8uXHJcbiAqICAgICAgICBjb250ZW50OlxyXG4gKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gKiAgICAgICAgICAgIHNjaGVtYTpcclxuICogICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gKiAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICogICAgICAgICAgICAgICAgbWVzc2FnZTpcclxuICogICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTWVuc2FqZSBpbmRpY2FuZG8gZWwgZXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3IuXHJcbiAqL1xyXG5wdWJsaWMgYXN5bmMgdXBkYXRlKHsgYXV0aCwgcmVxdWVzdCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gIHByb2Nlc3MuZW52Lk5PREVfVExTX1JFSkVDVF9VTkFVVEhPUklaRUQgPSAnMCc7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLnF1ZXJ5KCkud2hlcmUoJ2lkJyxhdXRoLnVzZXI/LmlkKS5wcmVsb2FkKCdkaXNwb3NpdGl2bycsKGRpc3Bvc2l0aXZvKSA9PiB7XHJcbiAgICAgIGRpc3Bvc2l0aXZvLnByZWxvYWQoJ3NlbnNvcmVzJywoc2Vuc29yKT0+e1xyXG4gICAgICAgIHNlbnNvci5wcmVsb2FkKCdzZW5zb3JUeXBlJylcclxuICAgICAgfSkucHJlbG9hZCgndGlwb0Rpc3Bvc2l0aXZvJylcclxuICAgIH0pLnByZWxvYWQoJ2NvbmZpZ3VyYXRpb25zJykuZmlyc3QoKTtcclxuXHJcbiAgICBpZighdXNlcil7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDA0KS5qc29uKHsgXHJcbiAgICAgICAgdHlwZTogJ0Vycm9yJyxcclxuICAgICAgICB0aXRsZTogJ1VzdWFyaW8gbm8gZW5jb250cmFkbycsXHJcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGVuY29udHJhciBsb3MgZGF0b3MgZGVsIHVzdWFyaW8nLCBcclxuICAgICAgICBlcnJvcjogW10gXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IHsgbmFtZSwgbGFzdG5hbWUsIGVtYWlsIH0gPSByZXF1ZXN0Lm9ubHkoWyduYW1lJywgJ2xhc3RuYW1lJywgJ2VtYWlsJ10pO1xyXG5cclxuICAgIC8vIENvbnN0cnV5ZSB1biBvYmpldG8gY29uIGxvcyBjYW1wb3MgcXVlIHNlIHZhbiBhIGFjdHVhbGl6YXJcclxuICAgIGNvbnN0IHVwZGF0ZXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcclxuICAgIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlcy5uYW1lID0gbmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobGFzdG5hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVzLmxhc3RuYW1lID0gbGFzdG5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGVtYWlsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlcy5lbWFpbCA9IGVtYWlsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFjdHVhbGl6YSBsb3MgZGF0b3MgZGVsIHVzdWFyaW8gZW4gbGEgYmFzZSBkZSBkYXRvcyBkaXJlY3RhbWVudGVcclxuICAgIGF3YWl0IERhdGFiYXNlLmZyb20oJ3VzZXJzJykud2hlcmUoJ2lkJywgdXNlci5pZCkudXBkYXRlKHVwZGF0ZXMpO1xyXG5cclxuICAgIC8vIE9idGllbmUgbG9zIGRhdG9zIGFjdHVhbGl6YWRvcyBkZWwgdXN1YXJpb1xyXG4gICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCBEYXRhYmFzZS5mcm9tKCd1c2VycycpLndoZXJlKCdpZCcsIHVzZXIuaWQpLmZpcnN0KCk7XHJcblxyXG4gICAgLy8gRW52w61hIGVsIGNvcnJlbyBlbGVjdHLDs25pY29cclxuICAgIGF3YWl0IE1haWwuc2VuZCgobWVzc2FnZSkgPT4ge1xyXG4gICAgICBtZXNzYWdlXHJcbiAgICAgICAgLmZyb20oRW52LmdldCgnU01UUF9VU0VSTkFNRScpLCAnSGVhbHRoeSBBcHAnKVxyXG4gICAgICAgIC50byh1c2VyLmVtYWlsKVxyXG4gICAgICAgIC5zdWJqZWN0KCdIZWFsdGh5IEFwcCAtIFBlcnNvbmFsaXphY2lvbiBkZSBjdWVudGEnKVxyXG4gICAgICAgIC5odG1sVmlldygnZW1haWxzL2FjdHVhbGl6YXJVc2VyJywgeyBuYW1lOiB1cGRhdGVzLm5hbWUgfHwgdXNlci5uYW1lLCBsYXN0bmFtZTogdXBkYXRlcy5sYXN0bmFtZSB8fCB1c2VyLmxhc3RuYW1lLCBlbWFpbDogdXBkYXRlcy5lbWFpbCB8fCB1c2VyLmVtYWlsIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICB0eXBlOiAnU3VjY2VzcyEhJyxcclxuICAgICAgdGl0bGU6ICdEYXRvcyBhY3R1YWxpemFkb3MnLFxyXG4gICAgICBtZXNzYWdlOiAnRGF0b3MgZGUgdXN1YXJpbyBhY3R1YWxpemFkb3MnLCBcclxuICAgICAgZGF0YTogdXBkYXRlZFVzZXIgXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDApLmpzb24oeyBcclxuICAgICAgdHlwZTogJ0Vycm9yJyxcclxuICAgICAgdGl0bGU6ICdFcnJvciBkZSBzZXJ2aWRvcicsXHJcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvciBhbCBhY3R1YWxpemFyIGxvcyBkYXRvcyBkZWwgdXN1YXJpbycsIFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSBcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4gLyoqXHJcbiAqIEBzd2FnZ2VyXHJcbiAqIC9hcGkvdXNlcnMvdXBkYXRlLXBhc3N3b3JkOlxyXG4gKiAgIHB1dDpcclxuICogICAgIHNlY3VyaXR5OlxyXG4gKiAgICAgICAtIGJlYXJlckF1dGg6IFtdXHJcbiAqICAgICB0YWdzOlxyXG4gKiAgICAgICAtIHVzZXJzXHJcbiAqICAgICBzdW1tYXJ5OiBBY3R1YWxpemFjacOzbiBkZSBjb250cmFzZcOxYSBkZSB1c3VhcmlvXHJcbiAqICAgICBkZXNjcmlwdGlvbjogQWN0dWFsaXphIGxhIGNvbnRyYXNlw7FhIGRlIHVuIHVzdWFyaW8gYXV0ZW50aWNhZG8uXHJcbiAqICAgICByZXF1ZXN0Qm9keTpcclxuICogICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICogICAgICAgY29udGVudDpcclxuICogICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gKiAgICAgICAgICAgc2NoZW1hOlxyXG4gKiAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICogICAgICAgICAgICAgcHJvcGVydGllczpcclxuICogICAgICAgICAgICAgICBvbGRQYXNzd29yZDpcclxuICogICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gKiAgICAgICAgICAgICAgIG5ld1Bhc3N3b3JkOlxyXG4gKiAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAqICAgICByZXNwb25zZXM6XHJcbiAqICAgICAgIDIwMDpcclxuICogICAgICAgICBkZXNjcmlwdGlvbjogQ29udHJhc2XDsWEgZGUgdXN1YXJpbyBhY3R1YWxpemFkYSBleGl0b3NhbWVudGUuXHJcbiAqICAgICAgICAgY29udGVudDpcclxuICogICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAqICAgICAgICAgICAgIHNjaGVtYTpcclxuICogICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICogICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gKiAgICAgICAgICAgICAgICAgbWVzc2FnZTpcclxuICogICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAqICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNZW5zYWplIGluZGljYW5kbyBlbCDDqXhpdG8gZGUgbGEgYWN0dWFsaXphY2nDs24gZGUgY29udHJhc2XDsWEuXHJcbiAqICAgICAgIDQwMDpcclxuICogICAgICAgICBkZXNjcmlwdGlvbjogRXJyb3IgZGUgc29saWNpdHVkIGRlYmlkbyBhIGRhdG9zIGZhbHRhbnRlcyBvIGludsOhbGlkb3MuXHJcbiAqICAgICAgICAgY29udGVudDpcclxuICogICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAqICAgICAgICAgICAgIHNjaGVtYTpcclxuICogICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICogICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gKiAgICAgICAgICAgICAgICAgZXJyb3I6XHJcbiAqICAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gKiAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTWVuc2FqZSBkZSBlcnJvciBpbmRpY2FuZG8gZWwgcHJvYmxlbWEgY29uIGxhIHNvbGljaXR1ZC5cclxuICogICAgICAgNDAxOlxyXG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBObyBhdXRvcml6YWRvLCB0b2tlbiBkZSBhY2Nlc28gaW52w6FsaWRvIG8gbm8gcHJvcG9yY2lvbmFkby5cclxuICogICAgICAgICBjb250ZW50OlxyXG4gKiAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICogICAgICAgICAgICAgc2NoZW1hOlxyXG4gKiAgICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gKiAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAqICAgICAgICAgICAgICAgICBlcnJvcjpcclxuICogICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAqICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNZW5zYWplIGRlIGVycm9yIGluZGljYW5kbyBsYSBmYWx0YSBkZSBhdXRvcml6YWNpw7NuLlxyXG4gKiAgICAgICA1MDA6XHJcbiAqICAgICAgICAgZGVzY3JpcHRpb246IEVycm9yIGludGVybm8gZGVsIHNlcnZpZG9yIGFsIGFjdHVhbGl6YXIgbGEgY29udHJhc2XDsWEgZGVsIHVzdWFyaW8uXHJcbiAqICAgICAgICAgY29udGVudDpcclxuICogICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAqICAgICAgICAgICAgIHNjaGVtYTpcclxuICogICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICogICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gKiAgICAgICAgICAgICAgICAgZXJyb3I6XHJcbiAqICAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gKiAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTWVuc2FqZSBkZSBlcnJvciBpbmRpY2FuZG8gZWwgcHJvYmxlbWEgaW50ZXJubyBkZWwgc2Vydmlkb3IuXHJcbiAqL1xyXG4gcHVibGljIGFzeW5jIHVwZGF0ZVBhc3N3b3JkKHsgYXV0aCwgcmVxdWVzdCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gIHByb2Nlc3MuZW52Lk5PREVfVExTX1JFSkVDVF9VTkFVVEhPUklaRUQgPSAnMCc7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9IGF1dGgudXNlcj8uaWQ7XHJcblxyXG4gICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLnF1ZXJ5KClcclxuICAgIC53aGVyZSgnaWQnLCB1c2VySWQpXHJcbiAgICAucHJlbG9hZCgnZGlzcG9zaXRpdm8nLChkaXNwb3NpdGl2bykgPT4ge1xyXG4gICAgICBkaXNwb3NpdGl2by5wcmVsb2FkKCdzZW5zb3JlcycsKHNlbnNvcik9PntcclxuICAgICAgICBzZW5zb3IucHJlbG9hZCgnc2Vuc29yVHlwZScpXHJcbiAgICAgIH0pLnByZWxvYWQoJ3RpcG9EaXNwb3NpdGl2bycpXHJcbiAgICB9KS5wcmVsb2FkKCdjb25maWd1cmF0aW9ucycpLmZpcnN0KCk7XHJcblxyXG4gICAgaWYoIXVzZXIpe1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwNCkuanNvbih7IFxyXG4gICAgICAgIHR5cGU6ICdFcnJvcicsXHJcbiAgICAgICAgdGl0bGU6ICdVc3VhcmlvIG5vIGVuY29udHJhZG8nLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBlbmNvbnRyYXIgbG9zIGRhdG9zIGRlbCB1c3VhcmlvJywgXHJcbiAgICAgICAgZXJyb3I6IFtdIFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjb25zdCBvbGRQYXNzd29yZDogc3RyaW5nID0gcmVxdWVzdC5pbnB1dCgnb2xkUGFzc3dvcmQnKTtcclxuICAgIGNvbnN0IG5ld1Bhc3N3b3JkOiBzdHJpbmcgPSByZXF1ZXN0LmlucHV0KCduZXdQYXNzd29yZCcpO1xyXG5cclxuICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IEhhc2gudmVyaWZ5KHVzZXIucGFzc3dvcmQsIG9sZFBhc3N3b3JkKTtcclxuICAgIGlmICghaXNQYXNzd29yZFZhbGlkKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdMYSBjb250cmFzZcOxYSBhbnRlcmlvciBlcyBpbmNvcnJlY3RhJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobmV3UGFzc3dvcmQubGVuZ3RoIDwgOCkge1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTGEgbnVldmEgY29udHJhc2XDsWEgZGViZSB0ZW5lciBhbCBtZW5vcyA4IGNhcmFjdGVyZXMnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHVzZXIucGFzc3dvcmQgPSBhd2FpdCBIYXNoLm1ha2UobmV3UGFzc3dvcmQpO1xyXG4gICAgYXdhaXQgdXNlci5zYXZlKCk7XHJcblxyXG4gICAgYXdhaXQgTWFpbC5zZW5kKChtZXNzYWdlKSA9PiB7XHJcbiAgICAgIG1lc3NhZ2VcclxuICAgICAgICAuZnJvbShFbnYuZ2V0KCdTTVRQX1VTRVJOQU1FJyksICdIZWFsdGh5IEFwcCcpXHJcbiAgICAgICAgLnRvKHVzZXIuZW1haWwpXHJcbiAgICAgICAgLnN1YmplY3QoJ0hlYWx0aHkgQXBwIC0gUmVjdXBlcmFjaW9uIGRlIENvbnRyYXNlw7FhJylcclxuICAgICAgICAuaHRtbFZpZXcoJ2VtYWlscy9udWV2YUNvbnRyYXNlbmEnLCB7IGVtYWlsOiB1c2VyLmVtYWlsIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgdHlwZTogJ0V4aXRvc28hIScsXHJcbiAgICAgIHRpdGxlOiAnQ29udHJhc2XDsWEgYWN0dWFsaXphZGEnLFxyXG4gICAgICBtZXNzYWdlOiAnQ29udHJhc2XDsWEgZGUgdXN1YXJpbyBhY3R1YWxpemFkYScgLFxyXG4gICAgICBkYXRhOiB1c2VyXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDApLmpzb24oeyBcclxuICAgICAgdHlwZTogJ0Vycm9yJyxcclxuICAgICAgdGl0bGU6ICdFcnJvciBhbCBhY3R1YWxpemFyIGNvbnRyYXNlw7FhJyxcclxuICAgICAgbWVzc2FnZTogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yIGFsIGFjdHVhbGl6YXIgbGEgY29udHJhc2XDsWEgZGVsIHVzdWFyaW8nLCBcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuICAvKipcclxuICAgKiBAc3dhZ2dlclxyXG4gICAqIC9hcGkvdXNlcnMve2lkfTpcclxuICAgKiAgZGVsZXRlOlxyXG4gICAqICAgIHNlY3VyaXR5OlxyXG4gICAqICAgICAgLSBiZWFyZXJBdXRoOiBbXVxyXG4gICAqICAgIHRhZ3M6XHJcbiAgICogICAgICAtIHVzZXJzXHJcbiAgICogICAgc3VtbWFyeTogRWxpbWluYWNpw7NuIGRlIGN1ZW50YSBkZSB1c3VhcmlvXHJcbiAgICogICAgZGVzY3JpcHRpb246IEVsaW1pbmEgbGEgY3VlbnRhIGRlIHVzdWFyaW8gYWN0dWFsLlxyXG4gICAqICAgIHJlc3BvbnNlczpcclxuICAgKiAgICAgICcyMDAnOlxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogQ3VlbnRhIGRlIHVzdWFyaW8gZWxpbWluYWRhIGV4aXRvc2FtZW50ZS5cclxuICAgKiAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAqICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICAgICAgICBtZXNzYWdlOlxyXG4gICAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTWVuc2FqZSBpbmRpY2FuZG8gZWwgw6l4aXRvIGRlIGxhIGVsaW1pbmFjacOzbi5cclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgZGVzdHJveSh7IHJlc3BvbnNlLCBhdXRoIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzdWFyaW8gPSBhdXRoLnVzZXIhXHJcbiAgICAgIGF3YWl0IHVzdWFyaW8uZGVsZXRlKClcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDQpLnNlbmQoe1xyXG4gICAgICAgIHR5cGU6ICdFeGl0b3NvISEnLFxyXG4gICAgICAgIHRpdGxlOiAnRXhpdG8gYWwgZWxpbWluYXIgdXN1YXJpbycsXHJcbiAgICAgICAgbWVzc2FnZTogJ1VzdWFyaW8gZWxpbWluYWRvIGV4aXRvc2FtZW50ZScsXHJcbiAgICAgICAgZGF0YTogdXN1YXJpb1xyXG4gICAgICB9KVxyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5zZW5kKHtcclxuICAgICAgICB0eXBlOiAnRXJyb3InLFxyXG4gICAgICAgIHRpdGxlOiAnRXJyb3IgYWwgYWxpbWluYXIgdXN1YXJpbycsXHJcbiAgICAgICAgbWVzc2FnZTogJ1NlIHByb2R1am8gdW4gZXJyb3IgYWwgZWxpbWluYXIgdXN1YXJpbydcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICogQHN3YWdnZXJcclxuICAgKiAvYXBpL3VzZXJzL2F1dGgtbG9naW46XHJcbiAgICogIHBvc3Q6XHJcbiAgICogICAgdGFnczpcclxuICAgKiAgICAgIC0gdXNlcnNcclxuICAgKiAgICBzdW1tYXJ5OiBWZXJpZmljYXIgc2VzacOzbiBkZSB1c3VhcmlvLlxyXG4gICAqICAgIGRlc2NyaXB0aW9uOiBJbmljaWEgc2VzacOzbiBkZSB1c3VhcmlvIHZlcmlmaWNhbmRvIGVsIGNvcnJlbyBlbGVjdHLDs25pY28geSBlbCBjw7NkaWdvIGRlIHZlcmlmaWNhY2nDs24uXHJcbiAgICogICAgcmVxdWVzdEJvZHk6XHJcbiAgICogICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAqICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgIHVzZXJfZW1haWw6XHJcbiAgICogICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgZm9ybWF0OiBlbWFpbFxyXG4gICAqICAgICAgICAgICAgICBwYXNzd29yZDpcclxuICAgKiAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX2NvZGU6XHJcbiAgICogICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICByZXF1aXJlZDpcclxuICAgKiAgICAgICAgICAgICAgLSB1c2VyX2VtYWlsXHJcbiAgICogICAgICAgICAgICAgIC0gcGFzc3dvcmRcclxuICAgKiAgICAgICAgICAgICAgLSB2ZXJpZmljYXRpb25fY29kZVxyXG4gICAqICAgIHJlc3BvbnNlczpcclxuICAgKiAgICAgIDIwMDpcclxuICAgKiAgICAgICAgZGVzY3JpcHRpb246IEluaWNpbyBkZSBzZXNpw7NuIGV4aXRvc28uXHJcbiAgICogICAgICAgIGNvbnRlbnQ6XHJcbiAgICogICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgIGV4YW1wbGU6XHJcbiAgICogICAgICAgICAgICAgIG1lc3NhZ2U6IEluaWNpbyBkZSBzZXNpw7NuIGV4aXRvc29cclxuICAgKiAgICAgIDQwMTpcclxuICAgKiAgICAgICAgZGVzY3JpcHRpb246IERhdG9zIGludsOhbGlkb3MgbyB1c3VhcmlvIG5vIHZlcmlmaWNhZG8uXHJcbiAgICogICAgICAgIGNvbnRlbnQ6XHJcbiAgICogICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgIGV4YW1wbGU6XHJcbiAgICogICAgICAgICAgICAgIHRpdGxlOiBEYXRvcyBpbnbDoWxpZG9zXHJcbiAgICogICAgICAgICAgICAgIG1lc3NhZ2U6IFVzdWFyaW8gbm8gdmVyaWZpY2FkbyBvIGRhdG9zIGluY29ycmVjdG9zXHJcbiAgICogICAgICAgICAgICAgIHR5cGU6IHdhcm5pbmdcclxuICAgKiAgICAgIDQwMDpcclxuICAgKiAgICAgICAgZGVzY3JpcHRpb246IEVycm9yIGFsIGluaWNpYXIgc2VzacOzbi5cclxuICAgKiAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAqICAgICAgICAgICAgZXhhbXBsZTpcclxuICAgKiAgICAgICAgICAgICAgbWVzc2FnZTogRXJyb3IgYWwgaW5pY2lhciBzZXNpw7NuXHJcbiAgICogICAgICAgICAgICAgIGVycm9yOiBEZXNjcmlwY2nDs24gZGVsIGVycm9yXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIGF1dGhMb2dpbih7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXJfZW1haWwgPSByZXF1ZXN0LmlucHV0KCd1c2VyX2VtYWlsJyk7XHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gcmVxdWVzdC5pbnB1dCgncGFzc3dvcmQnKTtcclxuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uQ29kZSA9IHJlcXVlc3QuaW5wdXQoJ3ZlcmlmaWNhdGlvbl9jb2RlJyk7XHJcblxyXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5xdWVyeSgpXHJcbiAgICAgICAgLndoZXJlKCdlbWFpbCcsIHVzZXJfZW1haWwpXHJcbiAgICAgICAgLndoZXJlKCd2ZXJpZmljYXRpb25fY29kZScsIHZlcmlmaWNhdGlvbkNvZGUpXHJcbiAgICAgICAgLndoZXJlTnVsbCgnZGVsZXRlZF9hdCcpXHJcbiAgICAgICAgLmZpcnN0KCk7XHJcblxyXG4gICAgICBpZiAoIXVzZXIgfHwgdXNlci52ZXJpZmljYXRpb25Db2RlICE9PSB2ZXJpZmljYXRpb25Db2RlKSB7XHJcbiAgICAgICAgLy8gRGV2b2x2ZXIgZXJyb3IgZGUgZGF0b3MgaW52w6FsaWRvc1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAxKS5zZW5kKHtcclxuICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJyxcclxuICAgICAgICAgIHRpdGxlOiAnRGF0b3MgaW52w6FsaWRvcycsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnVXN1YXJpbyBubyB2ZXJpZmljYWRvIG8gZGF0b3MgaW5jb3JyZWN0b3MnLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIShhd2FpdCBIYXNoLnZlcmlmeSh1c2VyLnBhc3N3b3JkLCBwYXNzd29yZCkpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDEpLnNlbmQoe1xyXG4gICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLFxyXG4gICAgICAgICAgdGl0bGU6ICdEYXRvcyBpbnbDoWxpZG9zJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdDb250cmFzZcOxYSBpbmNvcnJlY3RhJyxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdXNlci52ZXJpZmljYXRpb25Db2RlID0gbnVsbDtcclxuICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICAgIHR5cGU6ICdFeGl0b3NvISEnLFxyXG4gICAgICAgIHRpdGxlOiAnVmVyaWZpY2FkbycsXHJcbiAgICAgICAgbWVzc2FnZTogJ0N1ZW50YSBWZXJpZmljYWRhIENvcnJlY3RhbWVudGUnXHJcbiAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICB0eXBlOiAnRXJyb3InLFxyXG4gICAgICAgIHRpdGxlOiAnRXJyb3IgZGUgaW5pY2lvJyxcclxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgaW5pY2lhciBzZXNpw7NuJyxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEBzd2FnZ2VyXHJcbiAgICogL2FwaS91c2Vycy9sb2dvdXQ6XHJcbiAgICogIHBvc3Q6XHJcbiAgICogICAgc2VjdXJpdHk6XHJcbiAgICogICAgICAtIGJlYXJlckF1dGg6IFtdXHJcbiAgICogICAgdGFnczpcclxuICAgKiAgICAgIC0gdXNlcnNcclxuICAgKiAgICBzdW1tYXJ5OiBDaWVycmUgZGUgc2VzacOzbiBkZSB1c3VhcmlvXHJcbiAgICogICAgZGVzY3JpcHRpb246IENpZXJyYSBsYSBzZXNpw7NuIGFjdHVhbCBkZWwgdXN1YXJpby5cclxuICAgKiAgICByZXNwb25zZXM6XHJcbiAgICogICAgICAgMjAwOlxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogU2VzacOzbiBjZXJyYWRhIGV4aXRvc2FtZW50ZS5cclxuICAgKiAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAqICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICAgICAgICBtZXNzYWdlOlxyXG4gICAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTWVuc2FqZSBpbmRpY2FuZG8gZWwgw6l4aXRvIGRlbCBjaWVycmUgZGUgc2VzacOzbi5cclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgbG9nb3V0KHsgYXV0aCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgYXV0aC5sb2dvdXQoKVxyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMCkuc2VuZCh7XHJcbiAgICAgICAgdHlwZTogJ0V4aXRvc28hIScsXHJcbiAgICAgICAgdGl0bGU6ICdMb2dvdXQgZXhpdG9zbycsXHJcbiAgICAgICAgbWVzc2FnZTogJ0xvZ291dCBleGl0b3NhbWVudGUgJ1xyXG4gICAgICB9KVxyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICB0eXBlOiAnRXJyb3InLFxyXG4gICAgICAgIHRpdGxlOiAnRXJyb3IgYWwgY2VycmFyIHNlc2lvbicsXHJcbiAgICAgICAgbWVzc2FnZTogJ1NlIHByb2R1am8gdW4gZXJyb3IgYWwgY2VycmFyIHNlc2lvbidcclxuICAgICAgfSlcclxuICAgICAgXHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEBzd2FnZ2VyXHJcbiAgICogL2FwaS91c2Vycy9sb2dpbjpcclxuICAgKiAgcG9zdDpcclxuICAgKiAgICB0YWdzOlxyXG4gICAqICAgICAgLSB1c2Vyc1xyXG4gICAqICAgIHN1bW1hcnk6IEluaWNpYXIgc2VzacOzbiBkZSB1c3VhcmlvXHJcbiAgICogICAgcmVxdWVzdEJvZHk6XHJcbiAgICogICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAqICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgIGVtYWlsOlxyXG4gICAqICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBDb3JyZW8gZWxlY3Ryw7NuaWNvIGRlbCB1c3VhcmlvXHJcbiAgICogICAgICAgICAgICAgIHBhc3N3b3JkOlxyXG4gICAqICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBDb250cmFzZcOxYSBkZWwgdXN1YXJpb1xyXG4gICAqICAgIHJlc3BvbnNlczpcclxuICAgKiAgICAgIDIwMDpcclxuICAgKiAgICAgICAgZGVzY3JpcHRpb246IEluaWNpbyBkZSBzZXNpw7NuIGV4aXRvc29cclxuICAgKiAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAqICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICAgICAgICB0b2tlbjpcclxuICAgKiAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFRva2VuIGRlIGF1dGVudGljYWNpw7NuIGdlbmVyYWRvXHJcbiAgICogICAgICA0MDE6XHJcbiAgICogICAgICAgIGRlc2NyaXB0aW9uOiBDcmVkZW5jaWFsZXMgaW52w6FsaWRhc1xyXG4gICAqICAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICogICAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxyXG4gICAqICAgICAgICAgICAgICAgIG1lc3NhZ2U6XHJcbiAgICogICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgIGV4YW1wbGU6IFVzdWFyaW8gbm8gZW5jb250cmFkb1xyXG4gICAqICAgICAgNTAwOlxyXG4gICAqICAgICAgICBkZXNjcmlwdGlvbjogRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3JcclxuICAgKiAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAqICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICAgICAgICBtZXNzYWdlOlxyXG4gICAqICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICBleGFtcGxlOiBFcnJvciBhbCBpbmljaWFyIHNlc2nDs25cclxuICAgKiAgICAgICAgICAgICAgICBlcnJvcjpcclxuICAgKiAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBsb2dpbih7IHJlcXVlc3QsIGF1dGgsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGVtYWlsID0gcmVxdWVzdC5pbnB1dCgnZW1haWwnKTtcclxuICAgICAgY29uc3QgcGFzc3dvcmQgPSByZXF1ZXN0LmlucHV0KCdwYXNzd29yZCcpO1xyXG5cclxuICAgICAgLy8gVmVyaWZpY2FyIGxhcyBjcmVkZW5jaWFsZXMgZGVsIHVzdWFyaW9cclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIucXVlcnkoKS53aGVyZSgnZW1haWwnLCBlbWFpbCkucHJlbG9hZCgnZGlzcG9zaXRpdm8nLChkaXNwb3NpdGl2bykgPT4ge1xyXG4gICAgICAgIGRpc3Bvc2l0aXZvLnByZWxvYWQoJ3NlbnNvcmVzJywoc2Vuc29yKT0+e1xyXG4gICAgICAgICAgc2Vuc29yLnByZWxvYWQoJ3NlbnNvclR5cGUnKVxyXG4gICAgICAgIH0pLnByZWxvYWQoJ3RpcG9EaXNwb3NpdGl2bycpXHJcbiAgICAgIH0pLnByZWxvYWQoJ2NvbmZpZ3VyYXRpb25zJykuZmlyc3QoKVxyXG5cclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXN1YXJpbyBubyBlbmNvbnRyYWRvJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaXNQYXNzd29yZFZhbGlkID0gYXdhaXQgSGFzaC52ZXJpZnkodXNlci5wYXNzd29yZCwgcGFzc3dvcmQpO1xyXG5cclxuICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdDb250cmFzZcOxYSBpbmNvcnJlY3RhJyB9KTtcclxuICAgICAgfVxyXG4gICAgICAvLyBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyB5YSBlc3TDoSB2ZXJpZmljYWRvIGNvbiBzdSBjw7NkaWdvXHJcbiAgICAgIGlmICh1c2VyLnZlcmlmaWNhdGlvbkNvZGUgIT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdFbCB1c3VhcmlvIGHDum4gbm8gZXN0w6EgdmVyaWZpY2Fkby4gUG9yIGZhdm9yLCB2ZXJpZmlxdWUgc3UgY3VlbnRhLicgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgYXV0aC51c2UoJ2FwaScpLmdlbmVyYXRlKHVzZXIsIHsgZXhwaXJlc0luOiAnMyBkYXlzJyB9KTtcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICB0eXBlOiAnRXhpdG9zbyEhJyxcclxuICAgICAgICB0aXRsZTogJ0xvZ2luIGV4aXRvc28nLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdMb2dpbiBleGl0b3NhbWVudGUnLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHRva2VuLFxyXG4gICAgICAgICAgdXNlcixcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICB0eXBlOiAnRXJyb3InLFxyXG4gICAgICAgIHRpdGxlOiAnRXJyb3IgYWwgaW5pY2lhciBzZXNpb24nLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBpbmljaWFyIHNlc2nDs24nLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICogQHN3YWdnZXJcclxuICAgKiAvYXBpL3VzZXJzL3JlY3VwZXJhci1jb250cmE6XHJcbiAgICogICBwb3N0OlxyXG4gICAqICAgICB0YWdzOlxyXG4gICAqICAgICAgIC0gdXNlcnNcclxuICAgKiAgICAgc3VtbWFyeTogU29saWNpdGFyIHJlY3VwZXJhY2nDs24gZGUgY29udHJhc2XDsWFcclxuICAgKiAgICAgcmVxdWVzdEJvZHk6XHJcbiAgICogICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgKiAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgc2NoZW1hOlxyXG4gICAqICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgICBlbWFpbDpcclxuICAgKiAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgIGZvcm1hdDogZW1haWxcclxuICAgKiAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IENvcnJlbyBlbGVjdHLDs25pY28gZGVsIGFkbWluaXN0cmFkb3IgcGFyYSByZWN1cGVyYXIgbGEgY29udHJhc2XDsWFcclxuICAgKiAgICAgcmVzcG9uc2VzOlxyXG4gICAqICAgICAgIDIwMDpcclxuICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBDb3JyZW8gZWxlY3Ryw7NuaWNvIGVudmlhZG8gY29uIMOpeGl0b1xyXG4gICAqICAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgICAgIG1lc3NhZ2U6XHJcbiAgICogICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICAgZXhhbXBsZTogU2UgaGEgZW52aWFkbyB1biBjb3JyZW8gZWxlY3Ryw7NuaWNvIGNvbiB1biBjw7NkaWdvIGRlIHJlY3VwZXJhY2nDs24uXHJcbiAgICogICAgICAgNDAwOlxyXG4gICAqICAgICAgICAgZGVzY3JpcHRpb246IENvcnJlbyBlbGVjdHLDs25pY28gbm8gZW5jb250cmFkb1xyXG4gICAqICAgICAgICAgY29udGVudDpcclxuICAgKiAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgKiAgICAgICAgICAgICBzY2hlbWE6XHJcbiAgICogICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgKiAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICogICAgICAgICAgICAgICAgIG1lc3NhZ2U6XHJcbiAgICogICAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICogICAgICAgICAgICAgICAgICAgZXhhbXBsZTogTm8gc2UgZW5jb250csOzIHVuIGFkbWluaXN0cmFkb3IgY29uIGVzdGUgY29ycmVvIGVsZWN0csOzbmljby5cclxuICAgKiAgICAgICA1MDA6XHJcbiAgICogICAgICAgICBkZXNjcmlwdGlvbjogRXJyb3IgZGVsIHNlcnZpZG9yXHJcbiAgICogICAgICAgICBjb250ZW50OlxyXG4gICAqICAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAqICAgICAgICAgICAgIHNjaGVtYTpcclxuICAgKiAgICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxyXG4gICAqICAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgKiAgICAgICAgICAgICAgICAgbWVzc2FnZTpcclxuICAgKiAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgICBleGFtcGxlOiBFcnJvciBhbCBlbnZpYXIgZWwgY29ycmVvIGVsZWN0csOzbmljbyBkZSByZWN1cGVyYWNpw7NuLlxyXG4gICAqICAgICAgICAgICAgICAgICBlcnJvcjpcclxuICAgKiAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgKiAgICAgICAgICAgICAgICAgICBleGFtcGxlOiBNZW5zYWplIGRlIGVycm9yIGRldGFsbGFkb1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBjb3JyZW9yZWN1cGVyYWNpb24oeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICBwcm9jZXNzLmVudi5OT0RFX1RMU19SRUpFQ1RfVU5BVVRIT1JJWkVEID0gJzAnO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZW1haWwgPSByZXF1ZXN0LmlucHV0KCdlbWFpbCcpXHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLnF1ZXJ5KCkud2hlcmUoJ2VtYWlsJywgZW1haWwpLnByZWxvYWQoJ2Rpc3Bvc2l0aXZvJywoZGlzcG9zaXRpdm8pID0+IHtcclxuICAgICAgICBkaXNwb3NpdGl2by5wcmVsb2FkKCdzZW5zb3JlcycsKHNlbnNvcik9PntcclxuICAgICAgICAgIHNlbnNvci5wcmVsb2FkKCdzZW5zb3JUeXBlJylcclxuICAgICAgICB9KS5wcmVsb2FkKCd0aXBvRGlzcG9zaXRpdm8nKVxyXG4gICAgICB9KS5wcmVsb2FkKCdjb25maWd1cmF0aW9ucycpLmZpcnN0KClcclxuXHJcbiAgICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgIG1lc3NhZ2U6ICdObyBzZSBlbmNvbnRyw7MgdW4gdXN1YXJpbyBjb24gZXN0ZSBjb3JyZW8gZWxlY3Ryw7NuaWNvLicsXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uQ29kZSA9IHRoaXMuZ2VuZXJhcmNvZGlnbygpXHJcblxyXG4gICAgICB1c2VyLnZlcmlmaWNhdGlvbkNvZGUgPSB2ZXJpZmljYXRpb25Db2RlXHJcbiAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpXHJcblxyXG4gICAgICBhd2FpdCBNYWlsLnNlbmQoKG1lc3NhZ2UpID0+IHtcclxuICAgICAgICBtZXNzYWdlXHJcbiAgICAgICAgICAuZnJvbShFbnYuZ2V0KCdTTVRQX1VTRVJOQU1FJyksICdIZWFsdGh5IEFwcCcpXHJcbiAgICAgICAgICAudG8oZW1haWwpXHJcbiAgICAgICAgICAuc3ViamVjdCgnUmVjdXBlcmFjacOzbiBkZSBDb250cmFzZcOxYScpXHJcbiAgICAgICAgICAuaHRtbFZpZXcoJ2VtYWlscy9yZWN1cGVyYWNpb24nLCB7IHZlcmlmaWNhdGlvbkNvZGUgfSlcclxuICAgICAgfSlcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBtZXNzYWdlOiAnU2UgaGEgZW52aWFkbyB1biBjb3JyZW8gZWxlY3Ryw7NuaWNvIGNvbiB1biBjw7NkaWdvIGRlIHJlY3VwZXJhY2nDs24uJyxcclxuICAgICAgfSlcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgZW52aWFyIGVsIGNvcnJlbyBlbGVjdHLDs25pY28gZGUgcmVjdXBlcmFjacOzbi4nLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH1cclxuICBwdWJsaWMgZ2VuZXJhcmNvZGlnbygpIHtcclxuICAgIGNvbnN0IHJhbmRvbU51bWJlciA9IE1hdGguZmxvb3IoMTAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwKVxyXG4gICAgcmV0dXJuIHJhbmRvbU51bWJlci50b1N0cmluZygpXHJcbiAgfVxyXG59Il19